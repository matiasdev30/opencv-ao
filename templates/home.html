{% include "header.html" %}
<div class="flex">
    <!-- Menu à esquerda -->
    <nav class="w-1/6 bg-gray-100 p-4 h-screen overflow-auto">
        <h2 class="text-xl font-bold mb-4">Modelos disponiveis</h2>
        <ul>
            <form action="/upload" method="post" enctype="multipart/form-data" class="flex flex-col items-center bg-gray-50 p-6 rounded-lg shadow-lg">
                <input type="hidden" name="email" value="{{ email }}">
                
                <label for="file" class="mb-2 text-lg font-semibold text-gray-700">
                    Selecione um modelo de CV (PDF):
                </label>
                <input type="file" name="file" id="file" accept="application/pdf" required
                       class="mb-4 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300">
            
                <button type="submit" class="inline-block rounded-lg bg-indigo-500 px-8 py-3 text-center text-sm font-semibold text-white outline-none ring-indigo-300 transition duration-100 hover:bg-indigo-600 focus-visible:ring active:bg-indigo-700 md:text-base">
                Carrega modelo
                </button>
            </form>
            
            {% for pdf in pdf_files %}
            <li class="mb-4" id="pdf{{ loop.index }}">
                <div class="border p-2 rounded-lg shadow-lg">
                    <!-- Ajustar escala do iframe para reduzir os espaços -->
                    <div style="overflow: hidden; position: relative; width: 100%; padding-top: 141.42%;">
                        <iframe src="/static/pdf/{{ pdf }}#toolbar=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" class="mb-2"></iframe>
                    </div>
                    <a href="/static/pdf/{{ pdf }}" class="text-blue-500 hover:underline">{{ pdf }}</a>
                </div>
            </li>
            {% endfor %}
        </ul>
    </nav>

    <!-- Conteúdo à direita -->
    <div class="w-3/4 p-4 flex flex-col justify-between h-screen">
        <div>
            <h1 class="text-2xl font-bold mb-4">opencv-ao</h1>
            <h1>{{email}}</h1>
            <ul class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
                <!-- Conteúdo da lista -->
            </ul>
        </div>
        <img src="/static/img/resume-grid.avif" alt="Descrição da imagem" class="mt-auto max-w-full h-204 object-cover blur-sm opacity-0.5" />
    </div>
    
</div>

<script>
    const pdfFiles = {{ pdf_files | tojson }};
    console.log("PDFs encontrados:", pdfFiles); // Adicione este log
    pdfFiles.forEach((pdf, index) => {
        const url = `/static/pdf/${pdf}`;
        const canvasId = `pdf-canvas-${index + 1}`;
        
        const canvas = document.getElementById(canvasId);
        const context = canvas.getContext('2d');

        // Configurar PDF.js
        const loadingTask = pdfjsLib.getDocument(url);
        loadingTask.promise.then(function(pdf) {
            console.log("Carregando PDF:", pdf);
            // Renderizar a primeira página do PDF
            pdf.getPage(1).then(function(page) {
                const viewport = page.getViewport({ scale: 1 });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                page.render(renderContext);
            }).catch(function(error) {
                console.error("Erro ao renderizar a página do PDF:", error);
            });
        }).catch(function(error) {
            console.error("Erro ao carregar o PDF:", error);
        });
    });
</script>
